h2. Payment method - paypal website payments standard

nimbleSHOP has built in support for paypl website payments standard.

endprologue.

h3. Using pre-configured sandbox account

nimbleSHOP comes pre-configured with a paypal sandbox account. You can use this account to test the <tt>Checkout with paypal</tt> functionaly. Be sure to change the credentials before you go live.

h4. Logging into sandbox paypal account

Before you start testing you need to login at "paypal sandbox developer account":https://developer.paypal.com with following credentials:

<shell>
url:      https://developer.paypal.com
email:    neeraj_sandbox_paypal@bigbinary.com
password: 12345678
</shell>

h4. Purchasing using paypal

Now visit your shop and try to purchase something. In the checkout page click on "Checkout with paypal".

Once you are taken to the paypal login page , login with following credentials.

<shell>
email:    buyer_1323036620_per@bigbinary.com
password: 12345678
</shell>

h4. Purchase history in paypal

* To view purchase history in paypal first login to paypal sandbox developer account site as mentioned above.
* click on 'Test Accounts'
* Select 'seller_1323037155_biz@bigbinary.com' in the radio button.
* Click on 'Enter Sandbox Test Site'

Just for record here is the credentials to login as seller.

<shell>
email:    seller_1323037155_biz@bigbinary.com
password: 123456
</shell>

h3. Instant Payment Notification (IPN)


So Steve (buyer) click on 'checkout with paypal' because he wants to use paypal to pay for the order. The shop site takes Steve to PayPal page. Here Steve makes the payment. After Steve makes the payment, Steve is taken back to the shop and everything looks good. Steve thinks that he has successfully paid and the items will be delivered to him. And Steve is right. He did pay the amount. However as far as shop is concerned shop does not think Steve has because . Well lets slow down and try to break things into pieces to understand what's going on here.

Steve made a successful payment at PayPal. PayPal tells Steve all is good. So Steve is happy.

However now the question is how would store know that Steve indeed paid the full amount at PayPal. Until the shop is sure that Steve paid in full at PayPal items cannot be shipped to him.

This is where IPN comes in picture. IPN stands for Instant Payment Notification.

When Steve makes successful payment at PayPal, PayPal sends an IPN to the shop. Usually IPN is sent to the shop within a minute or two of Steve paying. However there have been cases were IPN was not sent for hours.

h4. Periodic IPN

Internet is not the most reliable medium when it comes to processing requests. HTTP requests get lost all the time. To ensure that the shop gets the IPN, PayPal keeps sending the IPN for 4 days. When shop gets an IPN then the shop should send that request back to PayPal. Now PayPal will send 'VERIFIED' or 'INVALID'. Only when the shop receives 'VERIFIED' and only when the payment status received with IPN is 'completed' the shop should send the merchandise to Steve. PayPal will stop sending IPN once it receives the message it sent.

h4. IPN documentation

IPN documentation is available "here":https://cms.paypal.com/cms_content/US/en_US/files/developer/IPNGuide.pdf . Go the bottom of "this page":https://cms.paypal.com/cgi-bin/marketingweb?cmd=_render-content&content_ID=developer/e_howto_admin_IPNIntro  to see an example of IPN .

nimbleSHOP handles all aspects of IPN so developers do not need to worry about it. This section has been added so that developers are aware of what nimbleSHOP does behind the scene.
